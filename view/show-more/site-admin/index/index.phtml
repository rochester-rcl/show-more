<?php
$this->htmlElement('body')->appendAttribute('class', 'show-more site-admin index');
$this->pageTitle($this->translate('Show More Settings'));
?>

<div id="page-actions">
    <?php echo $this->hyperlink($this->translate('Back to site admin'),
        $this->url('admin/site', [], true), ['class' => 'button']); ?>
</div>

<!-- Use a more robust approach -->
<form method="post">
    <fieldset>
        <legend><?php echo $this->translate('Show More Configuration'); ?></legend>

        <!-- Mode Selection -->
        <div class="field">
            <div class="field-meta">
                <label><?php echo $this->translate('Truncation Mode'); ?></label>
            </div>
            <div class="inputs">
                <label>
                    <input type="radio" name="show_more_mode" value="words"
                        <?php if (!isset($settings
                        )){$settings = array(

                        );}
                        echo ($settings['show_more_mode'] === 'words') ? 'checked' : ''; ?>>
                    <?php echo $this->translate('Words'); ?>
                </label>
                <label>
                    <input type="radio" name="show_more_mode" value="characters"
                        <?php echo ($settings['show_more_mode'] === 'characters') ? 'checked' : ''; ?>>
                    <?php echo $this->translate('Characters'); ?>
                </label>
            </div>
        </div>

        <!-- Limit -->
        <div class="field">
            <div class="field-meta">
                <label for="show_more_limit"><?php echo $this->translate('Limit'); ?></label>
            </div>
            <div class="inputs">
                <input type="number" name="show_more_limit" id="show_more_limit"
                       value="<?php echo $this->escapeHtml($settings['show_more_limit']); ?>"
                       min="0" max="10000" required>
            </div>
        </div>

        <!-- Excluded Properties -->
        <div class="field">
            <div class="field-meta">
                <label for="show_more_excluded_properties"><?php echo $this->translate('Excluded Properties'); ?></label>
                <div class="field-description">
                    <?php echo $this->translate('Select properties to exclude from Show More functionality.'); ?>
                </div>
            </div>
            <div class="inputs">
                <select name="show_more_excluded_properties[]" id="show_more_excluded_properties"
                        multiple="multiple" class="chosen-select"
                        data-placeholder="<?php echo $this->escapeHtmlAttr($this->translate('Select properties to exclude…')); ?>">
                    <?php foreach ($this->api()->search('properties')->getContent() as $property): ?>
                        <option value="<?php echo $property->id(); ?>"
                            <?php echo in_array($property->id(), $settings['show_more_excluded_properties']) ? 'selected' : ''; ?>>
                            <?php echo $this->escapeHtml($this->translate($property->label())); ?>
                            (<?php echo $this->escapeHtml($property->term()); ?>)
                        </option>
                    <?php endforeach; ?>
                </select>
            </div>
        </div>

        <!-- Expand All/Collapse All Button -->
        <div class="field">
            <div class="field-meta">
                <label for="show_more_expand_all_enabled"><?php echo $this->translate('Expand All/Collapse All Button'); ?></label>
                <div class="field-description">
                    <?php echo $this->translate('When enabled, an "Expand all/Collapse all" button will appear on pages with folded content.'); ?>
                </div>
            </div>
            <div class="inputs">
                <label>
                    <input type="checkbox" name="show_more_expand_all_enabled" id="show_more_expand_all_enabled" value="1"
                        <?php echo $settings['show_more_expand_all_enabled'] ? 'checked' : ''; ?>>
                    <?php echo $this->translate('Enable Expand All/Collapse All Button'); ?>
                </label>
            </div>
        </div>
    </fieldset>

    <div class="field">
        <input type="submit" value="<?php echo $this->escapeHtml($this->translate('Save')); ?>" class="button">
    </div>
</form>

<script>
    $(document).ready(function() {
        // Initialize Chosen
        $('#show_more_excluded_properties').chosen({
            placeholder_text_multiple: "<?php echo $this->escapeJs($this->translate('Select properties to exclude…')); ?>",
            width: "100%"
        });
    });
</script>